model Charge {
  id             String   @id @default(cuid())
  userId         String
  tierId         String
  tierVersionId  String?
  tierRevision   Int?
  stripeChargeId String   @unique
  createdAt      DateTime @default(now())

  user        User         @relation(fields: [userId], references: [id])
  tierVersion TierVersion? @relation(fields: [tierVersionId], references: [id])
  tier        Tier         @relation(fields: [tierId], references: [id])
}

model Subscription {
  id                   String    @id @default(cuid())
  userId               String
  tierId               String
  stripeSubscriptionId String    @unique
  tierVersionId        String?
  tierRevision         Int?
  activeUntil          DateTime?
  cancelledAt          DateTime?
  createdAt            DateTime  @default(now())
  state                String    @default("renewing")
  priceAnnual          Boolean   @default(false)
  active               Boolean   @default(true)

  user        User         @relation(fields: [userId], references: [id])
  tierVersion TierVersion? @relation(fields: [tierVersionId], references: [id])
  tier        Tier         @relation(fields: [tierId], references: [id])

  @@index([userId, tierId, active])
}
